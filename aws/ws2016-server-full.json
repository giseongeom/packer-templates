  {
    "variables": {
      "aws_access_key": "{{env `_MY_AWS_ACCESS_KEY_ID`}}",
      "aws_secret_key": "{{env `_MY_AWS_SECRET_ACCESS_KEY`}}",
      "aws_region": "{{env `_MY_AWS_DEFAULT_REGION`}}",
      "aws_win_password": "{{env `_MY_WINDOWS_DEFAULT_USER_PW`}}",
      "aws_ec2_type": "c4.large",
      "aws_ec2_user": "Administrator",
      "tags_env": "Production"
    }, 

  "builders": [{
    "type": "amazon-ebs",
    "source_ami_filter": {
      "filters": {
        "virtualization-type": "hvm",
        "architecture": "x86_64",
        "name": "Windows_Server-2016-English-Full-Base-*",
        "block-device-mapping.volume-type": "gp2",
        "root-device-type": "ebs"
      },
      "owners": [
        "amazon"
      ],
      "most_recent": true
    }, 
    "ami_name": "ami-ws2016-full-{{isotime \"2006.01.02-1504\" | clean_ami_name}}", 
    "communicator": "winrm",
    "winrm_username": "{{user `aws_ec2_user`}}", 
    "instance_type": "{{user `aws_ec2_type`}}",
    "tags": {
      "Env": "{{user `tags_env`}}"
    },
    "user_data_file": "./user_data/user_data_windows_server2016.txt"
  }],
  "provisioners": [
    {
      "type": "powershell",
      "scripts": [
        "../scripts/install-chef.ps1",
        "../scripts/install-choco.ps1",
        "../scripts/show-windows-update-status.ps1"
      ]
    },
    {
      "type": "windows-shell",
    "inline": [
      "choco install -y sysinternals",
      "choco install -y awscli",
      "choco install -y nodejs-lts googlechrome visualstudiocode",
      "choco install -y 7zip.portable curl wget nssm git"
      ]
    },
    {
      "type": "powershell",
      "scripts": [
        "../scripts/disable-windows-smb1.ps1"
      ]
    },
    {
      "type": "windows-restart"
    },
    {
      "type": "powershell",
      "scripts": [
        "../scripts/show-windows-update-status.ps1"
      ]
    },
    {
      "type": "powershell",
      "inline": [
        "New-Item -Path C:/Windows/Setup/Scripts -ItemType directory -Force",
        "New-Item -Path C:/Windows/Panther/Unattend -ItemType directory -Force"
      ]
    },
    {
      "type": "file",
      "source": "../files/WS2016/SetupComplete.cmd",
      "destination": "c:/windows/setup/scripts/SetupComplete.cmd"
    },
 
    {
      "type": "windows-shell",
      "scripts": [
        "../scripts/show-version.cmd"
      ]
    },
    {
    "type": "powershell",
      "scripts": [
        "../scripts/aws-ec2-ws2016-sysprep.ps1"
      ]
    }
  ]
}

